C51 COMPILER V9.54   WS2812_DRIVE                                                          10/09/2017 17:44:47 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE WS2812_DRIVE
OBJECT MODULE PLACED IN .\Objects\WS2812_Drive.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE WS2812_Drive.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(..\WSB2812µÆ) DEBUG
                    - OBJECTEXTEND PRINT(.\Listings\WS2812_Drive.lst) OBJECT(.\Objects\WS2812_Drive.obj)

line level    source

   1          #include<all.H>
   2          u8 xdata WS2812_Write_Buffer[Pixel_Data_Num];   //ÓÃÓÚ´æ´¢ÐèÒª·¢ËÍ¸øWS2812µÆµÄÊý¾ÝÊý×é
   3                                                                                                          //Pixel_Data_Num=25£¬ÊÇÒòÎª×Ü¹²8¸öµÆ
   4                                                                                                          //Ã¿¸öµÆÓÖÓÐºìÂÌÀ¶ÈýÖÖÑÕÉ«£¬Ã¿¸öÑÕÉ«¾ÍÊÇÒ»¸öÊý¾Ý
   5                                                                                                          //ÇÒ¶ÔWS2812·¢ËÍµÄµÚÒ»¸ö×Ö½ÚÊý¾ÝÊÇÎÞÐ§µÄ
   6                                                                                                          //¹ÊÐèÒªÊý¾ÝÎª3£¨3ÊÇÈýÖÖÑÕÉ«£©*8£¨8ÊÇµÆµÄÊýÄ¿£©+1£¨1ÊÇÎÞÐ§Êý¾Ý£©=25£»
   7                                                                                                          
   8          //***************************************************************************//
   9          //               WS2812µÄ³õÊ¼»¯º¯Êý
  10          //***************************************************************************//
  11          
  12          void WS2812_Init()
  13          {
  14   1              WS2812_DAT=1;                           //WS2812_DATÊÇWS2812µÄDIN£¨Êý¾ÝÊäÈë½Å£©£¬ÏÖÔÚÊÇP2^0¿Ú
  15   1                                                                      //ÔÚÓÐÊý¾ÝÊäÈëµÄÊ±ºòÊÇÖÃµÍ À´ ¸´Î»µÄ£¬ËùÒÔÆ½Ê±²»ÓÃÊÇÀ­¸ß
  16   1      }
  17          
  18          //***************************************************************************//
  19          //                              WS2812·¢ËÍÊý¾Ýº¯Êý
  20          //***************************************************************************//
  21          
  22          void WS2812_Write_Data(u8 *Point,u8 len)        //PointÊÇÒ»¸öÖ¸ÕëÖ¸ÏòWS2812_Write_Buffer[]Õâ¸öÊý×é£¬lenÊÇWS2812µÆ
             -µÄ¸öÊý
  23          {                                                                                       //WS2812_Write_Buffer[]Õâ¸öÊý×éµÄÃ¿Ò»¸öÊý¾Ý¶¼ÊÇ¶ÔÓ¦µÆÖéµÄÈýÖÖÑÕÉ«ÁÁµãµÄÊý¾Ý
  24   1                                                                                              //Í¨¹ý¿ØÖÆÃ¿¸öµÆÖéµÄÈý¸öÑÕÉ«ÁÁ¶ÈµÄ²»Í¬£¬Ê¹µÆÖéÏÔÊ¾²»Í¬ÑÕÉ«
  25   1              u8 idata i,j,k,Value;
  26   1              for(i=0;i<len;i++)                              //lenÊÇWS2812µÆµÄ¸öÊý£¬Ã¿¸öµÆ½øÐÐÒ»´Îfor()Ñ­»·£¬·¢ËÍÃ¿¸öµÆµÄÊý¾Ý
  27   1              {
  28   2                      for(j=0;j<3;j++)                        //Ã¿¸öWS2812µÆ¶¼ÓÐ3ÖÖÑÕÉ«£¬Õâ¸öfor()ÊÇÊ¹Ö¸ÕëÖ¸Ïò¶ÔÓ¦ÐèÒªÐ´ÈëÊý¾ÝµÄÑÕÉ«
  29   2                      {
  30   3                              switch(j)                               //ÓÉÓÚ²»Í¬³§¼ÒµÄµÆÖéºìÂÌÀ¶ÈýÖÖÑÕÉ«ÅÅ·ÅË³Ðò¿ÉÄÜ²»Í¬£¬¹Ê¿ÉÒÔÀûÓÃÖ¸ÕëÖ¸ÏòÊý×éÖÐ¶ÔÓ¦µÆÖéµÄÈýÖÖ
             -ÑÕÉ«ÁÁµãµÄÊý¾Ý£¬
  31   3                                                                              //¾Í¿ÉÒÔ²»ÓÃ¸Ä±ä·¢ËÍºìÂÌÀ¶Êý¾ÝµÄË³Ðò£¬À´Ó¦¶Ô²»Í¬ÑÕÉ«Ë³ÐòµÄµÆÖé
  32   3                              {
  33   4                                      case 0:
  34   4                                                      Value=*(Point+2);               //Ö¸ÕëPoint+2¼´ÊÇÊ¹Ö¸ÕëÖ¸ÏòÄ³µÆÖéµÄµÚÈý¸öÑÕÉ«£¬
  35   4                                                      break;                                  //*(Point+2)ÊÇ¶ÁÈ¡Ä³µÆÖéµÄµÚÈý¸öÑÕÉ«½«Æä¸³¸øValue£¬È»ºóÔÚÏÂÃæµÄfor()Ñ­»·ÖÐ·¢ËÍ¸øWS2812
  36   4                                      case 1:
  37   4                                                      Value=*(Point);                 //Ö¸ÕëPoint¼´ÊÇÊ¹Ö¸ÕëÖ¸ÏòÄ³µÆÖéµÄµÚÒ»¸öÑÕÉ«£¬
  38   4                                                      break;                                  //*(Point)ÊÇ¶ÁÈ¡Ä³µÆÖéµÄµÚÒ»¸öÑÕÉ«½«Æä¸³¸øValue£¬È»ºóÔÚÏÂÃæµÄfor()Ñ­»·ÖÐ·¢ËÍ¸øWS2812
  39   4                                      case 2:
  40   4                                                      Value=*(Point+1);               //Ö¸Õë*(Point+1)¼´ÊÇÊ¹Ö¸ÕëÖ¸ÏòÄ³µÆÖéµÄµÚ¶þ¸öÑÕÉ«£¬
  41   4                                                      break;                                  //*(Point+1)ÊÇ¶ÁÈ¡Ä³µÆÖéµÄµÚ¶þ¸öÑÕÉ«½«Æä¸³¸øValue£¬È»ºóÔÚÏÂÃæµÄfor()Ñ­»·ÖÐ·¢ËÍ¸øWS2812
  42   4                              }
  43   3                              for(k=0;k<8;k++)                                        //Ã¿¸öÑÕÉ«µÄÊý¾ÝÊÇ8Î»
  44   3                              {
  45   4                                      if((Value&0x80)==0x80)                  //ValueÊÇÄ³¸öµÆÖéµÄÄ³¸öÑÕÉ«µÄÁÁ¶ÈÊý¾Ý£¬Value&0x80£¬Ôò½á¹û²»ÊÇÎª0x80,¾ÍÊÇÎª0x0
             -0£»
  46   4                                      {                                                               //ËùÒÔ¿ÉÒÔÍ¨¹ýValue&0x80µÄ½á¹ûÀ´ÅÐ¶ÏValueµÄ×î¸ßÎ»ÊÇ1»¹ÊÇ0£¬Îª1¼´0x80£¬Îª0¼´0x00
  47   5                                                                                                      //¹ÊÈôValueÊ×Î»Îª1£¬Ôò(Value&0x80)==0x80ÎªÕæ£¬¼´ÔËÐÐifÀïÃæµÄÄÚÈÝ
  48   5                                                                                                      //Ò²¾ÍÊÇ·¢ËÍÊý¾Ý1¸øWS2812µÆÖéµÄDIN£¨Êý¾ÝÊäÈë½Å£©
  49   5                                              
  50   5                                              WS2812_DAT=1;                           //ÓÉWS2812µÄÊý¾ÝÊÖ²á¿ÉÒÔÖªµÀ£ºÊý¾Ý1¼´ÎªÏÈÊÇ¸ßµçÆ½£¨´ó¸Å0.85us×óÓÒ£©£¬
  51   5                                                                                                      //È»ºóÊÇµÍµçÆ½£¨´ó¸Å0.4us×óÓÒ£©£¬Ò»¶¨Òª¸ßµçÆ½Ê±¼ä>µÍµçÆ½Ê±¼ä£¬²ÅÊÇÊý¾Ý1
C51 COMPILER V9.54   WS2812_DRIVE                                                          10/09/2017 17:44:47 PAGE 2   

  52   5                                                                                                      //WS2812_DAT=1;¾ÍÊÇ½«WS2812µÆÖéµÄDIN£¨Êý¾ÝÊäÈë½Å£©P2^0À­¸ß
  53   5                                              _nop_();_nop_();_nop_();        //_nop_()ÊÇÑÓ³ÙÊÇÒ»¸öÖÜÆÚ£¬Ê¹ÓÃÇ°ÌáÊÇ#include<intrins.h>Í·ÎÄ¼þ
  54   5                                              _nop_();_nop_();_nop_();        //Ê¹ÓÃ¶à¸ö_nop_();À´Æðµ½¿ØÖÆÑÓÊ±¼äµÄ×÷ÓÃ£¬Ê¹¸ßµçÆ½Ê±¼ä´óÓÚµÍµçÆ½Ê±¼ä
  55   5                                              _nop_();_nop_();_nop_();
  56   5                                              _nop_();_nop_();_nop_();
  57   5                                              _nop_();_nop_();
  58   5                                              Value<<=1;                                      //Value×óÒÆÒ»Î»£¬Ê¹¸ßÎ»¶ªÆú£¬´Î¸ßÎ»±ä³É¸ßÎ»£¬Îª·¢ËÍÏÂÒ»Î»Êý¾Ý×ö×¼±¸
  59   5                                              WS2812_DAT=0;                           //WS2812_DAT=0¼´ÊÇDIN£¨Êý¾ÝÊäÈë½Å£©P2^0À­µÍ£¬¶ÌµÄµÍµçÆ½ÅäºÏÉÏÃæ³¤µÄ¸ßµçÆ½Íê³ÉÒ»Î»Êý¾
             -Ý1µÄ·¢ËÍ
  60   5                                              _nop_();                                        //´Ë´¦Ö»ÓÐÒ»¸ö_nop_()ÊÇÒòÎªµ¥Æ¬»ú»¹ÒªÔËÐÐÏÂÃæµÄ³ÌÐòËùÒÔ£¬µÍµçÆ½´æÔÚµÄÊ±¼ä²»Ö¹ÕâÒ»¸öÖÜÆÚ
  61   5                                                                                                      //ËùÒÔ´Ë´¦_nop_()²»ÒË¹ý¶à£¬·ñÔòµÍµçÆ½Ê±¼ä¾Í¿ÉÄÜ´óÓÚ¸ßµçÆ½Ê±¼äÁË£¬È»ºó·¢ËÍµÄÊý¾Ý¾Í²»ÊÇ1£¬·´¶øÊÇ
             -0
  62   5                                      }
  63   4                                      else                                                    //Èç¹û(Value&0x80)==0x80Îª¼Ù£¬¼´¸ÃÎ»Êý¾ÝÎª0
  64   4                                      {                                                               //·¢ËÍÊý¾Ý0£¬¼´ÏÈ·¢ËÍ¸ßµçÆ½£¨´ó¸Å0.4us£©£¬ÔÙ·¢ËÍµÍµçÆ½£¨´ó¸Å0.85us£©£¬¸ßµçÆ½Ê±¼ä<µÍµçÆ½Ê±¼ä£¬
             -²ÅÊÇ·¢ËÍÊý¾Ý0
  65   5                                              WS2812_DAT=1;                           //WS2812_DAT=1;¾ÍÊÇ½«WS2812µÆÖéµÄDIN£¨Êý¾ÝÊäÈë½Å£©P2^0À­¸ß
  66   5                                              _nop_();_nop_();_nop_();_nop_();_nop_();_nop_();_nop_();        //½Ï¶ÌÔÝÑÓÊ±£¬Ê¹WS2812_DATÎª¸ßµçÆ½Ò»¶ÎÊ±¼ä£¨
             -´ó¸Å0.4us£©
  67   5                                              WS2812_DAT=0;                                                                                           //WS2812_DAT=0;¾ÍÊÇ½«WS2812µÆÖéµÄDIN£¨Êý¾ÝÊäÈë½Å£©P2^0À­µÍ
  68   5                                              _nop_();_nop_();_nop_();_nop_();_nop_();_nop_();_nop_();_nop_();        //½Ï³¤Ê±¼äÑÓÊ±£¬ËäÈ»Ö»±ÈÉÏÃæ¸ßµçÆ½¶à
             -ÁËÒ»¸ö_nop_()
  69   5                                                                                                                                                                                      //µ«ÊÇÅäºÏÏÂÃæµÄ³ÌÐò£¬¿ÉÒÔÆðµ½Ê¹WS2812_DAT½Ï³¤Ê±¼äÎªµÍµçÆ½
  70   5                                                                                                                                                                                      //¾­¹ýÉÏÃæÊ¹WS282_DAT½Ï¶ÌµÄ¸ßµçÆ½£¬Óë½Ï³¤µÄµÍµçÆ½ºó£¬
  71   5                                                                                                                                                                                      //¾Í³É¹¦ µÄ·¢ËÍÊý¾Ý0ÁË
  72   5                                              
  73   5                                              Value<<=1;                                                                                                                      //Value×óÒÆÒ»Î»Ê¹´Î¸ßÎ»±äÎª×î¸ßÎ»£¬ÒÔ±ã·¢ËÍºóÃæµÄÊý¾Ý
  74   5                                      }
  75   4                              }
  76   3                      }
  77   2                      Point+=3;                                       //PointÊÇÒ»¸öÖ¸ÕëÖ¸ÏòWS2812_Write_Buffer[]Õâ¸öÊý×é£¬
  78   2                                                                              //WS2812_Write_Buffer[]Õâ¸öÊý×éµÄÃ¿Ò»¸öÊý¾Ý¶¼ÊÇ¶ÔÓ¦µÆÖéµÄÈýÖÖÑÕÉ«ÁÁµãµÄÊý¾Ý
  79   2                                                                              //¹ÊÃ¿Ò»¸öµÆÖéÕ¼ÓÃÊý×éÖÐ3¸ö×Ö½ÚµÄÊý¾Ý
  80   2                                                                              //ËùÒÔPoint+=3ÊÇÊ¹Ö¸ÕëPointÖ¸ÏòÏÂÒ»¸öµÆÖéµÄµÚÒ»¸öÑÕÉ«µÄÊý¾Ý
  81   2              }
  82   1      }
  83          
  84          //***************************************************************//
  85          //                              WS2812ÏÔÊ¾Êý¾Ý
  86          //***************************************************************//
  87          void WS2812_Display_Ser()
  88          {
  89   1              static xdata u8 count=0;
  90   1              if(count<100)                                           //¶ÔWS2812½øÐÐ¸´Î»
  91   1              {
  92   2                      WS2812_DAT=0;                                   //WS2812_DAT=0;ÊÇÎªÁË¶ÔWS2812½øÐÐ¸´Î»£¬Í¨¹ýWS2812µÄÊý¾ÝÊÖ²á¿ÉÖª
  93   2                                                                                      //¶ÔDIN£¨Êý¾ÝÊäÈë½Å£©¸øÓè´óÓÚ50usÒÔÉÏµÄµÍµçÆ½£¬¾Í»á¸´Î»
  94   2                                                                                      //Í¨¹ýcount++£»Ê¹countÔÚ´ïµ½100Ö®Ç°±£³ÖDIN£¨Êý¾ÝÊäÈë½Å£©ÎªµÍµçÆ½£¬½ø¶ø´ïµ½¸´Î»Ð§¹û
  95   2              }
  96   1              else                                                            //ÔÚ¸´Î»½áÊøºóÏòWS2812·¢ËÍÊý¾Ý
  97   1              {
  98   2                      EA=0;                                                   //¹Ø±ÕÖÐ¶Ï£¬ÒòÎªWS2812µÄÊý¾ÝÊÇÓÉ¸ßµÍµçÆ½ÅäºÏÍê³ÉµÄ£¬
  99   2                                                                                      //Èç¹û´æÔÚÖÐ¶Ï£¬¿ÉÄÜ»áÓ°Ïì¸ßµÍµçÆ½Åä±È£¬Ê¹·¢ËÍÊý¾ÝÊä´í
 100   2                      
 101   2                      WS2812_Write_Data(WS2812_Write_Buffer+1,8);             //PointÊÇÒ»¸öÖ¸ÕëÖ¸ÏòWS2812_Write_Buffer[]Õâ¸öÊý×éµÄµÚ¶þ¸öÊ
             -ý¾Ý
 102   2                                                                                                                      //ÒòÎªWS2812»áÉáÆúµÚÒ»¸öÊý¾Ý
 103   2                                                                                                                      //ÒòÎªÓÐ8¸öµÆÖé£¬ËùÒÔlen=8
 104   2                      
 105   2                      count=0;                                                                                //ÔÚ´Ë´ÎÊý¾Ý·¢ËÍÍêÖ®ºó£¬½«count=0£¬ÒÔ±ãÏÂÒ»´Î·¢ËÍÊý¾ÝÇ°³õÊ¼»¯   
 106   2                      
 107   2                      EA=1;                                                                                   //¿ªÖÐ¶Ï£¬ÒÔ±ãÖÐ¶ÏÏà¹Ø³ÌÐò¼ÌÐø½øÐÐ
C51 COMPILER V9.54   WS2812_DRIVE                                                          10/09/2017 17:44:47 PAGE 3   

 108   2              }
 109   1              count++;                                                                                        //count++£¬ÒÔ±ãÍê³ÉÉÏÃæ¶ÔDIN£¨Êý¾ÝÊäÈë½Å£©¸øÓè´óÓÚ50usÒÔÉÏµÄµÍµçÆ½£¬´ïµ½¸´Î»Ð§¹û
 110   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    184    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     26    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----       4
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
